{"version":3,"file":"index.js","sources":["src/ruin.js","src/index.js"],"sourcesContent":["export default class Ruin {\n  constructor(el) {\n    this.el = el;\n    this.chars = '!<>-_\\\\/[]{}â€”=+*^?#________';\n    this.update = this.update.bind(this);\n  }\n\n  randomChar() {\n    return this.chars[Math.floor(Math.random() * this.chars.length)];\n  }\n\n  update() {\n    let output = '';\n    let complete = 0;\n\n    for (let i = 0, n = this.queue.length; i < n; i += 1) {\n      const { from, to, start, end } = this.queue[i];\n      let { char } = this.queue[i];\n      if (this.frame >= end) {\n        complete += 1;\n        output += to;\n      } else if (this.frame >= start) {\n        if (!char || Math.random() < 0.28) {\n          char = this.randomChar();\n          this.queue[i].char = char;\n        }\n        output += `<span class=\"dud\">${char}</span>`;\n      } else {\n        output += from;\n      }\n    }\n\n    this.el.innerHTML = output;\n    if (complete === this.queue.length) {\n      this.resolve();\n    } else {\n      this.frameRequest = window.requestAnimationFrame(this.update);\n      this.frame += 1;\n    }\n  }\n\n  setText(newText) {\n    const oldText = this.el.innerHTML;\n    const length = Math.max(oldText.length, newText.length);\n    const promise = new Promise((resolve) => { this.resolve = resolve; });\n\n    this.queue = [];\n\n    for (let i = 0; i < length; i += 1) {\n      const from = oldText[i] || '';\n      const to = newText[i] || '';\n      const start = Math.floor(Math.random() * 40);\n      const end = start + Math.floor(Math.random() * 40);\n      this.queue.push({ from, to, start, end });\n    }\n\n    window.cancelAnimationFrame(this.frameRequest);\n    this.frameRequest = 0;\n    this.update();\n    return promise;\n  }\n}\n","import Ruin from './ruin';\n\nconst phrases = [\n  'Neo,',\n  'sooner or later',\n  'you\\'re going to realize',\n  'just as I did',\n  'that there\\'s a difference',\n  'between knowing the path',\n  'and walking the path',\n];\n\nconst el = document.querySelector('.text');\nconst fx = new Ruin(el);\n\nlet counter = 0;\nconst next = () => {\n  fx.setText(phrases[counter]).then(() => {\n    setTimeout(next, 800);\n  });\n  counter = (counter + 1) % phrases.length;\n};\n\nnext();\n\nexport default Ruin;\n"],"names":["Ruin","el","chars","update","bind","Math","floor","random","length","output","complete","i","n","queue","from","to","start","end","char","frame","randomChar","innerHTML","resolve","frameRequest","window","requestAnimationFrame","newText","oldText","max","promise","Promise","push","cancelAnimationFrame","phrases","document","querySelector","fx","counter","next","setText","then"],"mappings":"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"}